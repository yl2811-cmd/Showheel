@page
@model Showheel.Pages.IndexModel
@{
    ViewData["Title"] = "Yingrong Lin | Portfolio";
}

<section id="hero" class="full-section hero-section">
    <div class="section-inner hero-inner">
        <div class="hero-content-frame">
            <div class="hero-frame-overlay"></div>
            <div class="eyebrow">Cinematic sci-fi universes</div>
            <h1>Yingrong Lin</h1>
            <p class="subtitle">Sci-Fi Writer · 3D Environment Artist · Minecraft Mod Developer</p>
            <p class="contact-line">email: <a href="mailto:yl2811.rit.edu@gmail.com">yl2811.rit.edu@gmail.com</a></p>
            <p class="intro">I create long-form sci-fi stories and 3D worlds, focusing on worldbuilding, game mod development, and immersive environment design.</p>
            <div class="cta-row">
                <a class="primary-button" href="https://space.bilibili.com/3546770577558337/lists/6508504?type=season" target="_blank" rel="noopener noreferrer">View curated works and videos</a>
            </div>
            <p class="footnote">Let’s explore works ranked by awesomeness.</p>
        </div>
    </div>
</section>

<div class="wave-divider wave-hero" aria-hidden="true"></div>

<section id="feature" class="full-section feature-section" data-bg-parallax="11">
    <div class="section-inner">
        <div class="section-header">
            <p class="eyebrow">Flagship Experience</p>
            <h2>Skies Beyond the Star – Music Reading Experience</h2>
            <p class="lede">Explore Archeon as both a story world and an animated concept reel. This flagship project blends long-form sci-fi narrative with cinematic visuals and music.</p>
        </div>

        <div class="feature-grid">
            <div class="feature-main">
                <div class="media-frame video-frame">
                    <iframe
                        title="Skies Beyond the Star concept reel"
                        data-autoplay-video
                        data-video-id="sZlfea5VRAs"
                        allow="autoplay; encrypted-media; picture-in-picture"
                        allowfullscreen
                        loading="lazy"
                        src=""
                    ></iframe>
                </div>
                <p class="caption">The concept reel auto-plays as soon as you land here.</p>
            </div>
            <div class="feature-stack">
                <div class="stack-card">
                    <div class="card-heading">Click image to read the novel</div>
                    <a class="media-frame" href="https://www.wattpad.com/story/404103703-skies-beyond-the-star" target="_blank" rel="noopener noreferrer">
                        <img class="wander-image" data-wander data-wander-scroll="9" src="/images/anna-freedman.png" alt="Portrait of protagonist Anna Freedman" />
                    </a>
                    <p class="caption">Anna Freedman — the protagonist of Skies Beyond the Star.</p>
                </div>
                <div class="stack-card">
                    <div class="card-heading">Archeon vistas</div>
                    <div class="media-frame">
                        <img class="wander-image" data-wander data-wander-scroll="7" src="/images/gallery-05.png" alt="Sci-fi airship landscape from Archeon" />
                    </div>
                    <p class="caption">An airship crossing the frontier skies of Archeon.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<div class="wave-divider wave-feature" aria-hidden="true"></div>

@section Scripts {
    <script>
        (() => {
            const hero = document.getElementById('hero');
            if (!hero) {
                return;
            }

            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            const offsetFactor = window.innerWidth < 640 ? 0.04 : 0.12;
            let ticking = false;
            let lensTimer;
            const parallaxState = {
                targetX: 0,
                targetY: 0,
                currentX: 0,
                currentY: 0,
            };
            let parallaxMaxX = window.innerWidth < 640 ? 10 : 18;
            let parallaxMaxY = window.innerWidth < 640 ? 6 : 12;

            const applyOffset = () => {
                if (prefersReducedMotion) return;
                const offset = Math.max(-30, Math.min(window.scrollY * offsetFactor, 120));
                hero.style.setProperty('--hero-bg-offset', `${offset * -0.12}px`);
            };

            const applyParallax = () => {
                if (prefersReducedMotion) return;
                parallaxState.currentX += (parallaxState.targetX - parallaxState.currentX) * 0.08;
                parallaxState.currentY += (parallaxState.targetY - parallaxState.currentY) * 0.08;
                hero.style.setProperty('--hero-bg-parallax-x', `${parallaxState.currentX}px`);
                hero.style.setProperty('--hero-bg-parallax-y', `${parallaxState.currentY}px`);
                window.requestAnimationFrame(applyParallax);
            };

            const handlePointerMove = (event) => {
                if (prefersReducedMotion) return;
                const rect = hero.getBoundingClientRect();
                const normX = ((event.clientX - rect.left) / rect.width - 0.5) * 2;
                const normY = ((event.clientY - rect.top) / rect.height - 0.5) * 2;
                parallaxState.targetX = normX * -parallaxMaxX;
                parallaxState.targetY = normY * -parallaxMaxY;
            };

            const resetParallax = () => {
                parallaxState.targetX = 0;
                parallaxState.targetY = 0;
            };

            const triggerLens = () => {
                if (prefersReducedMotion) return;
                hero.classList.add('hero-lens-active');
                setTimeout(() => hero.classList.remove('hero-lens-active'), 1100);
            };

            const onScroll = () => {
                if (!ticking) {
                    window.requestAnimationFrame(() => {
                        applyOffset();
                        ticking = false;
                    });
                    ticking = true;
                }

                if (lensTimer) {
                    clearTimeout(lensTimer);
                }
                hero.classList.remove('hero-lens-active');
                lensTimer = window.setTimeout(triggerLens, 340);
            };

            applyOffset();
            applyParallax();
            window.addEventListener('scroll', onScroll, { passive: true });
            window.addEventListener('resize', () => {
                parallaxMaxX = window.innerWidth < 640 ? 10 : 18;
                parallaxMaxY = window.innerWidth < 640 ? 6 : 12;
            });
            hero.addEventListener('pointermove', handlePointerMove);
            hero.addEventListener('pointerleave', resetParallax);
        })();

        (() => {
            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            if (prefersReducedMotion) return;

            const wanderers = Array.from(document.querySelectorAll('[data-wander]'));
            if (!wanderers.length) return;

            const state = new WeakMap();

            const recalcBase = () => {
                wanderers.forEach(el => {
                    const rect = el.getBoundingClientRect();
                    const base = rect.top + window.scrollY;
                    const existing = state.get(el) || {};
                    state.set(el, {
                        ...existing,
                        base,
                        idleX: existing.idleX || 0,
                        idleY: existing.idleY || 0,
                    });
                });
            };

            const jitterTimers = [];

            const createJitter = (el) => {
                const timer = window.setInterval(() => {
                    const current = state.get(el);
                    if (!current) return;
                    current.targetIdleX = (Math.random() - 0.5) * 6;
                    current.targetIdleY = (Math.random() - 0.5) * 6;
                }, 3200 + Math.random() * 1200);

                jitterTimers.push(timer);
            };

            wanderers.forEach(el => {
                state.set(el, {
                    base: 0,
                    idleX: 0,
                    idleY: 0,
                    targetIdleX: 0,
                    targetIdleY: 0,
                });
                createJitter(el);
            });

            recalcBase();

            const update = () => {
                wanderers.forEach(el => {
                    const data = state.get(el);
                    if (!data) return;

                    const scrollDistance = (window.scrollY - data.base) * 0.012;
                    const clamped = Math.max(-1.2, Math.min(1.2, scrollDistance));
                    const intensity = parseFloat(el.dataset.wanderScroll || '10');

                    data.idleX += (data.targetIdleX - data.idleX) * 0.025;
                    data.idleY += (data.targetIdleY - data.idleY) * 0.025;

                    const offsetX = clamped * intensity + data.idleX;
                    const offsetY = clamped * -intensity * 0.4 + data.idleY;

                    el.style.transform = `translate3d(${offsetX}px, ${offsetY}px, 0)`;
                });

                window.requestAnimationFrame(update);
            };

            window.addEventListener('resize', recalcBase);
            window.addEventListener('scroll', recalcBase, { passive: true });

            update();

            window.addEventListener('beforeunload', () => {
                jitterTimers.forEach(timer => window.clearInterval(timer));
            });
        })();

        (() => {
            const prefersReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
            if (prefersReducedMotion) return;

            const parallaxSections = Array.from(document.querySelectorAll('[data-bg-parallax]'));
            if (!parallaxSections.length) return;

            const states = new Map();
            let pointerX = 0;
            let pointerY = 0;

            const clamp = (value, max) => Math.max(-max, Math.min(max, value));

            const recalcTargets = () => {
                parallaxSections.forEach(section => {
                    const rect = section.getBoundingClientRect();
                    const intensity = parseFloat(section.dataset.bgParallax || '10');
                    const centerOffsetY = (rect.top + rect.height / 2) - (window.innerHeight / 2);
                    const scrollInfluence = clamp(-centerOffsetY * 0.05, intensity);
                    const pointerInfluenceX = pointerX * intensity * 0.55;
                    const pointerInfluenceY = pointerY * intensity * 0.45;

                    const targetX = clamp(pointerInfluenceX, intensity);
                    const targetY = clamp(scrollInfluence + pointerInfluenceY, intensity);

                    const existing = states.get(section) || { currentX: 0, currentY: 0 };
                    states.set(section, {
                        ...existing,
                        targetX,
                        targetY,
                        max: intensity,
                    });
                });
            };

            const update = () => {
                parallaxSections.forEach(section => {
                    const state = states.get(section);
                    if (!state) return;

                    state.currentX += (state.targetX - state.currentX) * 0.08;
                    state.currentY += (state.targetY - state.currentY) * 0.08;

                    section.style.setProperty('--section-parallax-x', `${state.currentX}px`);
                    section.style.setProperty('--section-parallax-y', `${state.currentY}px`);
                });

                window.requestAnimationFrame(update);
            };

            const handlePointer = (event) => {
                const normX = (event.clientX / window.innerWidth - 0.5) * 2;
                const normY = (event.clientY / window.innerHeight - 0.5) * 2;
                pointerX = -normX;
                pointerY = -normY;
                recalcTargets();
            };

            parallaxSections.forEach(section => {
                const intensity = parseFloat(section.dataset.bgParallax || '10');
                states.set(section, {
                    currentX: 0,
                    currentY: 0,
                    targetX: 0,
                    targetY: 0,
                    max: intensity,
                });
            });

            recalcTargets();
            update();

            window.addEventListener('scroll', recalcTargets, { passive: true });
            window.addEventListener('resize', recalcTargets);
            window.addEventListener('pointermove', handlePointer);
            window.addEventListener('pointerleave', () => {
                pointerX = 0;
                pointerY = 0;
                recalcTargets();
            });
        })();

        (() => {
            const frame = document.querySelector('[data-autoplay-video]');
            if (!frame) return;

            const videoId = frame.dataset.videoId;
            if (!videoId) return;

            const buildSrc = () =>
                `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&loop=1&playlist=${videoId}&controls=1&rel=0&playsinline=1&modestbranding=1`;

            let activated = false;

            const startVideo = () => {
                if (activated) return;
                frame.src = buildSrc();
                activated = true;
            };

            if ('IntersectionObserver' in window) {
                const observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting && entry.intersectionRatio >= 0.35) {
                            startVideo();
                            observer.disconnect();
                        }
                    });
                }, { threshold: [0.35] });

                observer.observe(frame);
            } else {
                startVideo();
            }
        })();
    </script>
}

<section id="gallery" class="full-section gallery-section" data-bg-parallax="14">
    <div class="section-inner">
        <div class="section-header">
            <p class="eyebrow">Worldbuilding</p>
            <h2>Archeon Environment Gallery</h2>
            <p class="lede">A selection of key locations, airships, and towns from the Skies Beyond the Star universe.</p>
        </div>
        <div class="gallery-grid">
            <div class="gallery-card"><img src="/images/avatar-01.png" alt="Archeon town square at night" /></div>
            <div class="gallery-card"><img src="/images/gallery-02.png" alt="Airship hovering above glowing city" /></div>
            <div class="gallery-card"><img src="/images/gallery-03.png" alt="Bridge and lanterns over futuristic canal" /></div>
            <div class="gallery-card"><img src="/images/gallery-04.png" alt="Skyline of Archeon with neon clouds" /></div>
            <div class="gallery-card"><img src="/images/gallery-05.png" alt="Vast plateau with sci-fi ruins" /></div>
            <div class="gallery-card"><img src="/images/gallery-06.png" alt="Floating island and ships at dusk" /></div>
            <div class="gallery-card"><img src="/images/gallery-07.png" alt="Mountain range with futuristic structures" /></div>
            <div class="gallery-card"><img src="/images/gallery-08.png" alt="Frontier city skyline" /></div>
            <div class="gallery-card"><img src="/images/gallery-09.png" alt="Airship departing from a stone tower" /></div>
        </div>
        <div id="contact" class="contact-footer">
            <h3>Yingrong Lin</h3>
            <p>Email: <a href="mailto:yl2811.rit.edu@gmail.com">yl2811.rit.edu@gmail.com</a></p>
            <div class="contact-links">
                <a href="https://github.com/yl2811-cmd" target="_blank" rel="noopener noreferrer">GitHub</a>
                <span aria-hidden="true">•</span>
                <a href="https://space.bilibili.com/3546770577558337" target="_blank" rel="noopener noreferrer">Bilibili</a>
            </div>
        </div>
    </div>
</section>
